#!/bin/bash
whois "$1" 2>/dev/null | awk 'BEGIN{FS=":"; OFS=","} /^[[:space:]]*(Registrant|Admin|Tech) ?[[:alpha:]]*:?$/ {sec=$0; gsub(/[[:space:]:]+$/,"",sec); next} NF>1 && sec && $0 !~ /^>>>/ && $0 !~ /^%/ && $0 !~ /^#/ && $0 !~ /^;/ {gsub(/\r$/,""); f=$1; gsub(/^[ \t]+|[ \t]+$/,"",f); $1=""; v=substr($0,2); gsub(/^[ \t]+|[ \t]+$/,"",v); if(f ~ /Street$/) v=v" "; if(f ~ /Ext$/) f=f":"; print sec, f, v}' | grep -v '^$' | tr '\n' '\r' | tr '\r' '\n' | sed '$ s/$//'
